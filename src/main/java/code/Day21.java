package code;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.ArrayDeque;
import java.util.HashSet;
import java.util.Queue;
import java.util.Set;
import java.util.StringTokenizer;

public class Day21 {
    public static void main(String[] args){

        String input = """
                ...........
                .....###.#.
                .###.##..#.
                ..#.#...#..
                ....#.#....
                .##..S####.
                .##..#...#.
                .......##..
                .##.#.####.
                .##..##.##.
                ...........
                """;

        input = """
                ...................................................................................................................................
                .#.###.......#.##...........................#...#....#.#.#.#...........#.......##....#.#.........#....#....#.........##.##.....#...
                .#.......#.......#.....#...............#..#.#.#....#......#..............###.....#...........#...#......##..............#......#.#.
                ................#....................#.......#...#......................#..................#...#.........#.......###...........##..
                ..#..###...........#.##....#..........#...........##..#.#............................#........#..#.#.#..#....#..#...#...##......##.
                ..........#.....##....#........#......#........#...#..#.............................#........#.#.....#....#..#.#....#...#......#.#.
                ....#..........##.....#...........#..........#....................#...........#.........#.....#.#...#..##.........#.......#........
                .......#.#..#.####....................#.#...#.....#.................#...........#....#...........#....##......#....................
                ..##......#.#..#.#...#..............#.........#....#................#........#.#...#.........#..................#........#.#..#....
                ....#.#.#.........#..#..............#.#......#................................#......#.....#....##.............##..#....#....#...#.
                ..#.................#.#.#.......#...#........#................#.#...............................#..#.#.......#.......#.......#.....
                .#...#.#.#....................#..#......#...#.#...........#....##.......#.......#...........#............#.#.##......#..#..........
                ..#.....##............#..#...#..........#..#...#.........#...#........#............##...#....#...........#..#......#.....#.##.#....
                ...............#.#..#.#.....#......##.#.......##..............##..........................#........#.....#.#....#.....#.....#......
                ...........#...#.#....#.....#........##..................#..#......#.##....#........#.#..#.#...............#.#.........#.....#.....
                ..............##.....#..#.......#.........#..............##........................................#..#...##....#.........#.#......
                .#.........#.#.......##......#...#...#...............##....##......####...#..................#............##.......#..#.##..#......
                ......#.......#............##.#....#......................#.............#...#.#.........##................#.#.............#...#.#..
                ........#.#........##............#...#...............#.#....##..............#...............#.................#.#..#.#.....#.#...#.
                ...#......#....#....#....#..#......#....................##..#............#..#...........#.......................#......##......#...
                .............##.....#..#.##............#.............##......#......#..#..#..#...............#.............#..#.......##...........
                ............##.#...#..........................................#............#.................##.......##....#.........#..#.#.......
                ...##.#.##..#......#.......##......#.#............#.#.....#............#.##...................#.............#..###..#.#....#....##.
                ......#......#................##....##.................#..#.#.#.#....#.......#...............#...............#..........#...##.....
                ....#.................#..........##..........##....#..#........#.........##.#.....................###......#..............#..#.....
                .###.............#.#........................................#.#.#..#...#.......................#.###...........###....#.......#..#.
                ..#...#..#........#...#.........#...........#....#....#.#...#.#....#...#.#...........................###.....#....#...#.....#......
                ..#.......##.....#.#...#.......#..........#.#.......#...#..#.#.........#.............#.............#.....##..##.........#..........
                ..........#......#..#.....#..............#..#...#.#.#...#.#...#...#...#..............................##..#...####.##...##..........
                .....#..............#..........##............#.#..#.......#.#...#...##.##....#.......##...#............#.#............#.....#....#.
                .#........#..............#..............#..###....#...#......#..........#.............#..............#...#...#.#........#..........
                ...............#.#....#...................#........##..#..##..............#.#..............................###....#.....#....#.....
                ......#.#.........#.......#...............#....#.#..#..###.#.........#..#...#......#..#..#...........#.......##......#..#......#...
                .#..................##..#...........#.##.....#....#....................#.....#........###..............#.....##.....##....#..#.....
                .#...#..#..............#.#.........#............#....#....##..........##..#.......#.####....##.#.....................#.............
                ......#............#....##...........#...........##........#...#...#.....................###.#...........#.............#........#..
                ...................##.............................#.#....#...#.....#..#......#............#.................#......#.....#.#.#.....
                ...........#..#........#..........##....#.........##..#........#...#.#..#...#.............#....#.............#.#..#...........#.##.
                ...#.........##......................#.#..........##...#.#..##......#...#...................#.#.#...............###............#.#.
                .....#..#......................#.#.................#..#.........#.#.........#...#...#..##...#.....#.#..................#...........
                .#..............................#......#..............####...........#...#.#........##.............................##....#.........
                ...................#.........#.....#......#.#.................#.#...#..#............#......#........##..............#.#.#..........
                .......#.#.#...............#.#..#..##..............#..#.#...##.........#.#......##.....................#.......#.............#.....
                ..#...#.#...#......................#....#...##..#.......##...#.........#......###...##...#...........................#.............
                ................#..............##............#.......#..........#.......#..........#..................#..............#...#.........
                ...#.#.........#....................#................#..........#....#...#..#.......##..#....#..##.........................##......
                .#..#....##.................#..........#...#.....#....#.......#.#..#......#...#.................#.......###..........#.....#..#.#..
                ....#....#............#....#.#...##.###..........#.......#...##.#...#...................##......#..#......#...............#........
                .........#...................#........#....#...#....##......#.....#.#..#.#......#..#.##....#.....#.....#.....#..................##.
                .....................#.....#...............###.................#......#...###.##.........#..#....#......#.............#....###..#..
                ......................#......#..#.......#...#...###..#........##..........#...#...........#.....##.........#.#.#...................
                ..#..................#............#.#..#....#.#...............#..............##.....#..#......#.#..##.......#..............##......
                ............................#.........#.....#.#..........#.............###.....#..##...#.#...#...#....#.....#...............#......
                ......#.....................#....#...#............#.....#..............##........#......#.#.......###.......#...#.........#..#.....
                .......#.........#.#..#........##.#....#...#...#...#.......#....#........#...###.##..#.......#......#......................#.......
                ...#............##.....#..#.......#......#...#...#.......#..#..#......#....#.....#.................#...#.......#.............#.....
                ..##.................#...#.#...............###..###.....#...#........#......#.........#.#..##.#...#....#....#.......#..............
                ....#...........##.................#..........................#.....#...............#.............#.......#........#...............
                ...........#.....#......#........#.......#.......#......#..............................#..#...#.....#..........................#...
                ..#............#.#.....##......#.#...###.#.....#.##....#.......................#........##............#.......#.#.#................
                ...........#...........#.......#......#.....#.##.#.........#............#......#...#..#.#.........###..#...#.#.#.......#...........
                .........##.....#..........#..........#.........#..........#...#..........#...............#...........#.#.......#..................
                .........#.....#.............#.............#.#.#...#.##.......#.#...#....#.#............#.........#.#...........##.....#...........
                ..........#.....................##....#.....#...#.#..#.#.............#..#.#......#..............##....#...............#............
                ..........#.#...#..#..............#....##.....#....#.#.......#..#.#.............#...........#.......#..........#......#..#...#.....
                .................................................................S.................................................................
                ..........###....................................#.......###........#........#....#.................###........#...................
                ......##......#...#....#.....#...#....#..#...#.....#...#..............#.......#.#.#.#...###.#......#..#..#....#.......#..#.........
                ..........#...#...........#.#.#.##.#...................#..........####.......#.###.#.......#.....#.###....#...#..#.##......#.......
                ...........#................#....#....#.......#.................#.......#...#............#...#..............#..##..................
                ..................#.............................##...#...##..#...........#.........#.#....#...........#.....#..........#.#.........
                ................#.......#.#...##.###.....#....#...#.........#.#...........#.#.......##.#...#....#.......#..#.##....#...#...........
                ..............##..#.#....#...#..............##.......#....................#....#....#.#.##....#.......#..#..#......#..#..........#.
                ....#..............##..#.#...##.....#............##.#...#..#..........#.#...###................#.......#..##..#....................
                ...............#..#.........................#...............#......#...#.................#..#.....#....#.#.##..#................#..
                ....#................#..#.........#....#..#....#..........#.#.....##............###........##..........#.....#.................#...
                ...#......................#.......#....#..............#.........#..........#...#....#...............##..#...................#..#...
                .#...#...................#....#........#...#......##....##..#...#............#...#.#.#......#.#..#......##.................#...#...
                ...#..................#......#...#.#......#......#..###..##.#.....#...#..##.................#.#.#.##.......##....#..........#......
                .........##..............#.................##...............#..#......#.#.......#..#....................#.....#....................
                .....#....#............#......##...#.......##.....#...............#....#..#...#.............#................#................#.##.
                ........................##.....#.....#....................#.......#...............#....#.#..#....#.....#......................###..
                .....#................#...#......#...#...............#..#...#.....#..............#..#.........#....#.....#..#............#......#..
                ........#..............#...........###.......................#.#...##.#..##........#....#.#....#......#...#..........#.............
                ......#.......#.............#..........#..........#.#.#.#...#.................#.......####.........................#....###.#......
                ....#...#...#.#..........#.......#.......#...#..##.#.###....###.......#...................................#..........#..#..#...#...
                .#.......#....###...............#.............#....#..##..........#...........#...#.....##....#..#.................................
                ..#............#.#.........#....##.#.........#....#....#...#.#.#..#......#...##......#..........##.#...#............#....#.##.##.#.
                ......#........#..............##.##......#..........##.##.....##......#..#........................#..#.........##..#........#......
                ..................................##.....#.....#.......#....#.....#..........................###.#.#...........##........#.#.......
                .#.......#........#...........#...........#.........#...........#...#.......#...#.#.......##.......................................
                .##.#.......#........#.........#...#............#...........#.......#.#........#..#....#.......#...............#..........#..#.....
                ......#....#.......#...........#......#.................#...........##.......#...#.........#.#.##..#........#....#.......#..#......
                .#........##.....##...............#......#....#..#..#..#.#...#....#............#.....#.............................#.........#.....
                ..#...#..........#................#.....#..#...#....................#.#..#............#.....#..##...........###..................#.
                ..........#..#..#........................#..#..#.........##.........#.......#......#.........#...............#...#......##.....#...
                ...#.....#...##........#....................................#..........#...#.......#..#....#.#..........#.#.#...#............#..#..
                .....#........#.....#....................#........#....#...........#....#...#................#....................#........##......
                .......#.#.#.......#.......##..........#...#..#..#......#...#.......##...##.....##.#.................#.........##...##.............
                .............#..#.....#.#....##........#.....#.......#....#............##...#..#........................#......#......#......#.....
                ...#.....#......#.......#.#.............#...............#.....##.........#..#.........#.............#..#...#...#..........#...#....
                ........#.......................#........#.#.......##..#.##...###..#..#....#.#.....##........................#...................#.
                ............#..#.#.#......#...........................#.............#.#.......#..#..................#..........#..............#....
                .#.....#..#..##..##............##.#........##..#..#...................#.......#...................#.......#.......##.#.............
                .#.#..#...#.#.........#.#..#......#.........#.#..............#.#....#..#.....#....#.#.....................##........#..#....#....#.
                ..#....#.#........#..........#...#..#.....................#...#........#.....###.....................#.#..#..#..#...#.#..#.........
                .#.......#..#....#...............#..#...............#......#................#................#......###....#.................#.....
                ....#.#..#...#..#....#..#..#...........................#..#...#.#.#................#..................#........#.......#.......#.#.
                ........#.........................#...#............#......#.#...........#.....#....#.......#.#.#...#....#.......#...#.....##.......
                ......#...#....#.......#.....##.#...............#................................#.........##.##......#.#.....#................#...
                ..#..#....#.#.#.......#......#.........#............#..........#............#..............#..#...#.#...##..#...#........#.#.#.....
                ..#.......#.....##......#........#....##..........................##...#.#.#.................................#.#.......#..##.......
                ....#..#...##............#....##...#......#.........................#......#.##.........##..........#..............##...#..........
                ...#...#...#........#..#......#...#.....#......................#.........#..#..........#.........##.........##.....................
                .......#.............#.......#.......#....#.#........#.....#.#..#.#....................#..........#.#.....#.#.......#..#...........
                .#............#..###..........#..............................#......##...................##............##...#.#......#...........#.
                ...#........................#..........##..#.......................#......#.........###...................#..#...................#.
                .#......................#..##.#....#...........#..........#.......................#...#..#.....##....#.##......#...................
                .#.........#.....#...#......##..#...#....#..#......................#.................#.#.............#.....#.....##......#.........
                ....#.........#........#.#.....#....#...#....#....................#.....#.......#........#.....#.....#.#..........#.......#......#.
                ...#..#........#......##.......................#.............#......##.........#.....#...#.#...#.#...........#.......##........#...
                .......#.........##.....#.#.............#...#......#........#..#......#.........#............#.#.......#.#............#..##.#......
                ........#..#......#.#..#...#.....#..............................................##..#..#.....##..#......#..#.#...#.........#....#..
                .#.#...#.....#.#................##..#.........#.#.##..#..........................#..#..........#.....##.###.#.........#....#.......
                ........#.#..............#......#....#..........#.....##....................#....#..........#.............#..#....#..........#.....
                .......#...................##...#.#...#...#.#...###.##.##.........#............#.#.#..................#...#.#..##......#...#.......
                ....#.....#....###.....###........#......#.....#.....#..............................#..#........#....##........#...#..........#....
                ..###.#..#........#.....#...#.#.#.#....##.....#.#.........................#.##..#...#.....................##.....#........#.....##.
                ..#.#.#.##...#.#....#.##...#.......#.#......#.##.........#.............#.#.....#...........#.....##..........#........#....#.......
                ......##................#.#.......#............#..#......##.#.......................#........#.#.#...#.....#.........#...#.#.......
                ...................................................................................................................................
                """;

        String[] lines = input.trim().split("\n");
        int n = lines.length;
        int m = lines[0].trim().length();

        char[][] grid = parseInput(input);

        int sr = 0, sc = 0;
        for (int i = 0; i < n; i++) {
            for (int j = 0; j < m; j++) {
                if (grid[i][j] == 'S') {
                    sr = i;
                    sc = j;
                }
            }
        }

        Set<Cell> ans = new HashSet<>();
        Set<Cell> seen = new HashSet<>();
        Queue<Cell> q = new ArrayDeque<>();
        q.add(new Cell(sr, sc, 64));
        seen.add(new Cell(sr, sc,-1));

        while (!q.isEmpty()) {
            Cell current = q.poll();
            int r = current.r;
            int c = current.c;
            int s = current.s;

            if (s % 2 == 0) {
                ans.add(new Cell(r, c,-1));
            }
            if (s == 0) {
                continue;
            }

            int[][] directions = {{1, 0}, {-1, 0}, {0, 1}, {0, -1}};
            for (int[] dir : directions) {
                int nr = r + dir[0];
                int nc = c + dir[1];

                if (nr < 0 || nr >= n || nc < 0 || nc >= m || grid[nr][nc] == '#' || seen.contains(new Cell(nr, nc,-1))) {
                    continue;
                }

                seen.add(new Cell(nr, nc,-1));
                q.add(new Cell(nr, nc, s - 1));
            }
        }

        System.out.println(ans.size());
    }

    static class Cell {
        int r;
        int c;
        int s;

        public Cell(int r, int c, int s) {
            this.r = r;
            this.c = c;
            this.s = s;
        }

        @Override
        public boolean equals(Object o) {
            if (this == o) return true;
            if (o == null || getClass() != o.getClass()) return false;

            Cell cell = (Cell) o;

            if (r != cell.r) return false;
            if (c != cell.c) return false;
            return s == cell.s;
        }

        @Override
        public int hashCode() {
            int result = r;
            result = 31 * result + c;
            result = 31 * result + s;
            return result;
        }
    }

    private static char[][] parseInput(String input) {
        String[] lines = input.trim().split("\n");
        int numRows = lines.length;
        int numCols = lines[0].trim().length();
        char[][] grid = new char[numRows][numCols];

        for (int i = 0; i < numRows; i++) {
            String line = lines[i].trim();
            for (int j = 0; j < numCols; j++) {
                grid[i][j] = line.charAt(j);
            }
        }

        return grid;
    }
}
